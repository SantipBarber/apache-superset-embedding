<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="eticco_superset_integration.SupersetDashboardFieldTemplate">
        <div class="o_field_superset_dashboard" t-att-class="props.class">
            
            <div class="superset_toolbar bg-light p-3 border rounded mb-3">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <label class="form-label fw-bold mb-2">
                            <i class="fa fa-dashboard me-2"></i>
                            Seleccionar Dashboard
                        </label>
                        <select class="form-select" 
                                t-att-name="props.name"
                                t-att-value="currentDashboardId"
                                t-on-change="onDashboardSelectionChange">
                            <option value="">-- Selecciona un dashboard --</option>
                            <t t-foreach="getDashboardOptions()" t-as="option" t-key="option[0]">
                                <option t-att-value="option[0]" 
                                        t-esc="option[1]">
                                </option>
                            </t>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex gap-2 mt-4">
                            <button class="btn btn-primary" 
                                    t-on-click="loadSelectedDashboard"
                                    t-att-disabled="!currentDashboardId or ['no_config', 'no_dashboards', 'error'].includes(currentDashboardId)">
                                <i class="fa fa-play me-1"></i>
                                Cargar Dashboard
                            </button>
                            <button class="btn btn-secondary" 
                                    t-on-click="reloadCurrentDashboard"
                                    t-att-disabled="!isDashboardLoaded">
                                <i class="fa fa-refresh me-1"></i>
                                Actualizar
                            </button>
                            <div class="ms-auto">
                                <span t-if="isDashboardLoaded" class="badge bg-success">
                                    <i class="fa fa-check-circle"></i> Dashboard Activo
                                </span>
                                <span t-elif="currentDashboardId and !['no_config', 'no_dashboards', 'error'].includes(currentDashboardId)" 
                                      class="badge bg-warning">
                                    <i class="fa fa-clock-o"></i> Listo para cargar
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div t-if="currentDashboardId and !['no_config', 'no_dashboards', 'error'].includes(currentDashboardId)">
                <SupersetDashboard 
                    dashboardId="currentDashboardId"
                    modelName="props.record.resModel"
                    recordId="props.record.resId"
                    autoLoad="false"
                    className="props.class"
                    height="props.height"
                    t-on-dashboard-loaded="onDashboardLoaded"
                    t-on-dashboard-error="onDashboardError"
                />
            </div>
            
            <div t-elif="!currentDashboardId or ['no_config', 'no_dashboards', 'error'].includes(currentDashboardId)" 
                 class="superset_placeholder text-center py-5 border rounded"
                 t-attf-style="height: {{ props.height }}; background-color: #f8f9fa;">
                <div class="d-flex flex-column justify-content-center h-100">
                    <i class="fa fa-arrow-up fa-4x text-muted mb-3"></i>
                    <h4 class="text-muted">Selecciona un dashboard</h4>
                    <p class="text-muted">Elige un dashboard del men√∫ desplegable y haz clic en "Cargar Dashboard"</p>
                    
                    <div t-if="currentDashboardId === 'no_config'" class="mt-3">
                        <div class="alert alert-warning d-inline-block">
                            <i class="fa fa-exclamation-triangle"></i>
                            Configura Superset en Ajustes primero
                        </div>
                    </div>
                    
                    <div t-elif="currentDashboardId === 'no_dashboards'" class="mt-3">
                        <div class="alert alert-info d-inline-block">
                            <i class="fa fa-info-circle"></i>
                            No hay dashboards con embedding habilitado
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </t>
</templates>